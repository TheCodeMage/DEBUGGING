{"ast":null,"code":"import axios from 'axios';\nconst API = axios.create({\n  baseURL: process.env.REACT_APP_API_URL\n});\nAPI.interceptors.request.use(async config => {\n  const token = localStorage.getItem('access');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => Promise.reject(error));\n\n// Token refresh interceptor\nAPI.interceptors.response.use(res => res, async err => {\n  var _err$response;\n  const originalRequest = err.config;\n  if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401 && !originalRequest._retry && localStorage.getItem('refresh')) {\n    originalRequest._retry = true;\n    try {\n      const res = await axios.post(`${process.env.REACT_APP_API_URL}/token/refresh/`, {\n        refresh: localStorage.getItem('refresh')\n      });\n      localStorage.setItem('access', res.data.access);\n      originalRequest.headers.Authorization = `Bearer ${res.data.access}`;\n      return axios(originalRequest);\n    } catch (e) {\n      localStorage.clear();\n      window.location.href = \"/\";\n    }\n  }\n  return Promise.reject(err);\n});\nexport default API;","map":{"version":3,"names":["axios","API","create","baseURL","process","env","REACT_APP_API_URL","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","error","Promise","reject","response","res","err","_err$response","originalRequest","status","_retry","post","refresh","setItem","data","access","e","clear","window","location","href"],"sources":["C:/Users/Layla/Desktop/The-Book-Nook/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst API = axios.create({\r\n    baseURL: process.env.REACT_APP_API_URL,\r\n});\r\n\r\nAPI.interceptors.request.use(\r\n    async (config) => {\r\n        const token = localStorage.getItem('access');\r\n        if (token) {\r\n            config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n        return config;\r\n    },\r\n    (error) => Promise.reject(error)\r\n);\r\n\r\n// Token refresh interceptor\r\nAPI.interceptors.response.use(\r\n    res => res,\r\n    async err => {\r\n        const originalRequest = err.config;\r\n        if (\r\n            err.response?.status === 401 &&\r\n            !originalRequest._retry &&\r\n            localStorage.getItem('refresh')\r\n        ) {\r\n            originalRequest._retry = true;\r\n            try {\r\n                const res = await axios.post(`${process.env.REACT_APP_API_URL}/token/refresh/`, {\r\n                    refresh: localStorage.getItem('refresh')\r\n                });\r\n                localStorage.setItem('access', res.data.access);\r\n                originalRequest.headers.Authorization = `Bearer ${res.data.access}`;\r\n                return axios(originalRequest);\r\n            } catch (e) {\r\n                localStorage.clear();\r\n                window.location.href = \"/\";\r\n            }\r\n        }\r\n        return Promise.reject(err);\r\n    }\r\n);\r\n\r\nexport default API;\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,GAAG,GAAGD,KAAK,CAACE,MAAM,CAAC;EACrBC,OAAO,EAAEC,OAAO,CAACC,GAAG,CAACC;AACzB,CAAC,CAAC;AAEFL,GAAG,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,CACxB,MAAOC,MAAM,IAAK;EACd,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;EAC5C,IAAIF,KAAK,EAAE;IACPD,MAAM,CAACI,OAAO,CAACC,aAAa,GAAG,UAAUJ,KAAK,EAAE;EACpD;EACA,OAAOD,MAAM;AACjB,CAAC,EACAM,KAAK,IAAKC,OAAO,CAACC,MAAM,CAACF,KAAK,CACnC,CAAC;;AAED;AACAf,GAAG,CAACM,YAAY,CAACY,QAAQ,CAACV,GAAG,CACzBW,GAAG,IAAIA,GAAG,EACV,MAAMC,GAAG,IAAI;EAAA,IAAAC,aAAA;EACT,MAAMC,eAAe,GAAGF,GAAG,CAACX,MAAM;EAClC,IACI,EAAAY,aAAA,GAAAD,GAAG,CAACF,QAAQ,cAAAG,aAAA,uBAAZA,aAAA,CAAcE,MAAM,MAAK,GAAG,IAC5B,CAACD,eAAe,CAACE,MAAM,IACvBb,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,EACjC;IACEU,eAAe,CAACE,MAAM,GAAG,IAAI;IAC7B,IAAI;MACA,MAAML,GAAG,GAAG,MAAMpB,KAAK,CAAC0B,IAAI,CAAC,GAAGtB,OAAO,CAACC,GAAG,CAACC,iBAAiB,iBAAiB,EAAE;QAC5EqB,OAAO,EAAEf,YAAY,CAACC,OAAO,CAAC,SAAS;MAC3C,CAAC,CAAC;MACFD,YAAY,CAACgB,OAAO,CAAC,QAAQ,EAAER,GAAG,CAACS,IAAI,CAACC,MAAM,CAAC;MAC/CP,eAAe,CAACT,OAAO,CAACC,aAAa,GAAG,UAAUK,GAAG,CAACS,IAAI,CAACC,MAAM,EAAE;MACnE,OAAO9B,KAAK,CAACuB,eAAe,CAAC;IACjC,CAAC,CAAC,OAAOQ,CAAC,EAAE;MACRnB,YAAY,CAACoB,KAAK,CAAC,CAAC;MACpBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG;IAC9B;EACJ;EACA,OAAOlB,OAAO,CAACC,MAAM,CAACG,GAAG,CAAC;AAC9B,CACJ,CAAC;AAED,eAAepB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}